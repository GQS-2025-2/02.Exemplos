# ‚öîÔ∏è Git Avan√ßado: Conflitos & Resolu√ß√£o (Merge/Rebase)

Este guia pr√°tico cria **conflitos reais** e mostra como resolv√™-los usando **merge** e **rebase**. Ideal para treinar em um reposit√≥rio de teste.

> Pr√©-requisitos:
> - Git instalado e configurado (`user.name`, `user.email`)
> - Conforto com os comandos b√°sicos (init, add, commit, branch, log)

---

## üß™ 0) Prepara√ß√£o do cen√°rio

Crie um reposit√≥rio de teste e um arquivo base:
```bash
mkdir git-conflitos && cd git-conflitos
git init
echo "linha 1" > notas.txt
echo "linha 2" >> notas.txt
echo "linha 3" >> notas.txt
git add .
git commit -m "base: cria notas.txt com 3 linhas"
git branch -M main
```

---

## üß© A) Conflito com **merge**

### 1) Gerar conflitos em branches diferentes
Crie uma branch e altere a **mesma linha** de `notas.txt`:
```bash
git checkout -b feature/a
sed -i '' 's/linha 2/linha 2 - alterada na feature A/' notas.txt
git commit -am "feature A: altera linha 2"
```

Volte para `main` e altere **a mesma linha** de um jeito diferente:
```bash
git checkout main
sed -i '' 's/linha 2/linha 2 - alterada na main/' notas.txt
git commit -am "main: altera linha 2"
```

### 2) Tentar mesclar e ver o conflito
```bash
git merge feature/a
```
Sa√≠da esperada (resumo):
```
Auto-merging notas.txt
CONFLICT (content): Merge conflict in notas.txt
Automatic merge failed; fix conflicts and then commit the result.
```

### 3) Inspecionar conflito
```bash
git status
# mostra arquivos com conflito
git diff
# mostra marcadores de conflito no arquivo
```

Abra o `notas.txt` e voc√™ ver√° algo como:
```
linha 1
<<<<<<< HEAD
linha 2 - alterada na main
=======
linha 2 - alterada na feature A
>>>>>>> feature/a
linha 3
```

### 4) Resolver conflito manualmente
Edite `notas.txt` para o conte√∫do desejado (exemplo de resolu√ß√£o):
```
linha 1
linha 2 - alterada (merge das ideias)
linha 3
```

Marque como resolvido e finalize o merge:
```bash
git add notas.txt
git commit -m "merge: resolve conflito em notas.txt"
```

Dica: voc√™ pode usar uma ferramenta gr√°fica se tiver (`git mergetool`).

---

## üîÅ B) Conflito com **rebase**

Vamos criar outro conflito usando rebase (reaplicar commits por cima de outro hist√≥rico).

### 1) Preparar novas diverg√™ncias
Crie uma nova branch a partir de `main`:
```bash
git checkout -b feature/b
echo "linha 4 - feature B" >> notas.txt
git commit -am "feature B: adiciona linha 4"
```

Volte em `main` e crie mudan√ßa conflitante na **mesma regi√£o**:
```bash
git checkout main
echo "linha 4 - main" >> notas.txt
git commit -am "main: adiciona linha 4 diferente"
```

### 2) Rebase da branch feature/b sobre main
```bash
git checkout feature/b
git rebase main
```
Sa√≠da t√≠pica:
```
Applying: feature B: adiciona linha 4
CONFLICT (content): Merge conflict in notas.txt
```

### 3) Resolver conflito durante rebase
Edite `notas.txt`, escolha a resolu√ß√£o final (exemplo):
```
linha 1
linha 2 - alterada (merge das ideias)
linha 3
linha 4 - resolu√ß√£o rebase
```

Sinalize resolu√ß√£o e continue o rebase:
```bash
git add notas.txt
git rebase --continue
```
Se quiser **pular** um commit problem√°tico:
```bash
git rebase --skip
```
Para **abortar** e voltar ao estado anterior:
```bash
git rebase --abort
```

Ap√≥s completar, mescle em `main` (fast-forward):
```bash
git checkout main
git merge feature/b
```

---

## üåø C) Rebase interativo (limpar hist√≥rico)

Use para **reorganizar**, **squash** (fundir) e **renomear** mensagens de commit.

Crie alguns commits ‚Äúruins‚Äù na branch:
```bash
git checkout -b feature/hist
echo "a" >> dev.txt && git add . && git commit -m "WIP"
echo "b" >> dev.txt && git add . && git commit -m "fix"
echo "c" >> dev.txt && git add . && git commit -m "mais coisas"
```

Inicie um rebase interativo dos √∫ltimos 3 commits:
```bash
git rebase -i HEAD~3
```
No editor, altere por exemplo para:
```
pick <hash1> WIP
squash <hash2> fix
reword <hash3> mais coisas
```
- `squash`: funde o commit com o anterior
- `reword`: altera a mensagem de commit

Finalize salvando. Ao final, sua branch ter√° um hist√≥rico mais limpo.

> ‚ö†Ô∏è Evite reescrever hist√≥rico j√° **publicado** (empurrado para o remoto) em branches compartilhadas. Combine com o time.

---

## üéØ D) Cherry-pick com conflito (trazer commit espec√≠fico)

Crie uma situa√ß√£o onde voc√™ quer **trazer um commit espec√≠fico** de outra branch e lida com conflitos:

```bash
git checkout -b feature/c
echo "config=ABC" > app.conf
git add app.conf
git commit -m "feat: adiciona config ABC"
```

Volte para `main` e crie um commit que mexe no mesmo arquivo:
```bash
git checkout main
echo "config=XYZ" > app.conf
git add app.conf
git commit -m "chore: define config XYZ"
```

Agora, fa√ßa cherry-pick do commit da feature (pegue o hash real do commit ‚Äúconfig ABC‚Äù):
```bash
git cherry-pick <HASH_DO_COMMIT_ABC>
```
Se houver conflito, resolva editando `app.conf`, depois:
```bash
git add app.conf
git cherry-pick --continue
```
Abortar se necess√°rio:
```bash
git cherry-pick --abort
```

---

## üßπ E) Reverter e resetar (quando deu ruim)

### Reverter um commit (gera novo commit ‚Äúanti-mudan√ßa‚Äù):
```bash
git revert <HASH>
```
> Seguro em hist√≥rico j√° publicado.

### Resetar (mover o ponteiro da branch) ‚Äî **perigoso**:
- Soft (mant√©m mudan√ßas no stage):
```bash
git reset --soft <HASH>
```
- Mixed (default, mant√©m mudan√ßas na working tree):
```bash
git reset <HASH>
```
- Hard (descarta tudo at√© o hash) **‚ö†Ô∏è cuidado**:
```bash
git reset --hard <HASH>
```

---

## üß≠ Dicas pr√°ticas 

- Antes de iniciar um merge/rebase, **atualize sua branch**: `git fetch` + `git pull --rebase` (ou `git pull`).
- Em PRs no GitHub com conflitos, voc√™ pode usar o bot√£o **Resolve conflicts** no site ou resolver localmente na branch do PR e dar `git push`.
- Padronize mensagens de commit (ex.: Conventional Commits: `feat:`, `fix:`, `docs:`‚Ä¶).
- Prefira **rebase** para manter hist√≥rico linear em branches de feature; prefira **merge** em branches protegidas/compartilhadas.
- Atalhos √∫teis:
  - `git log --oneline --graph --decorate --all`
  - `git status`
  - `git diff` / `git difftool`
  - `git restore --staged <arquivo>` para tirar do stage
  - `git checkout -- <arquivo>` para descartar mudan√ßas locais no arquivo (‚ö†Ô∏è cuidado)

---

# üíª Usando GitHub Codespaces para Praticar Conflitos

Voc√™ pode simular e resolver conflitos de **merge** e **rebase** diretamente no **GitHub Codespaces**, sem precisar configurar nada localmente.

## Como abrir um Codespace

1. Acesse o reposit√≥rio no GitHub (ex.: `git-conflitos`).
2. Clique em **Code** ‚Üí aba **Codespaces**.
3. Clique em **Create codespace on main**.

Isso abrir√° um VS Code no navegador, j√° com Git instalado.

## Vantagens
- Ambiente pronto sem instalar nada localmente.
- Editor com destaque de conflitos integrado.
- Terminal para rodar todos os comandos de `merge`, `rebase`, `cherry-pick` etc.

Todos os exerc√≠cios descritos neste guia podem ser realizados dentro do terminal do Codespace, aproveitando o editor para visualizar e resolver conflitos de forma interativa.
